# ๐ ูุธุงู ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงูููุงุฒูุฉ ุชููุงุฆูุงู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู **ุงูุฅูุดุงุก ุงูุชููุงุฆู ููุญุณุงุจุงุช ุงูููุงุฒูุฉ** ูู ุงููุธุงู ุงููุญุงุณุจู ุงููุฒุฏูุฌ:
- โ ุนูุฏ ุฅุถุงูุฉ ุญุณุงุจ **ูุงูู** (cash) โ ูููุดุฆ ุญุณุงุจ **ูุฒูู** (gold) ููุงุฒู ุชููุงุฆูุงู
- โ ุนูุฏ ุฅุถุงูุฉ ุญุณุงุจ **ูุฒูู** (gold) โ ูููุดุฆ ุญุณุงุจ **ูุงูู** (cash) ููุงุฒู ุชููุงุฆูุงู
- โ **ุงูุฑุจุท ุงูุชููุงุฆู** ุนุจุฑ `memo_account_id` ูู ุงูุงุชุฌุงููู

---

## ๐ฏ ุงูููุงุนุฏ ุงูุฃุณุงุณูุฉ

### 1๏ธโฃ ุงูุญุณุงุจ ุงููุงูู โ ุงููุฒูู

```python
ุญุณุงุจ ูุงูู:
- ุฑูู: 1170
- ุงุณู: ุจูู ุณุงุจ
- transaction_type: 'cash'

        โฌ๏ธ ุฅูุดุงุก ุชููุงุฆู

ุญุณุงุจ ูุฒูู:
- ุฑูู: 71170  (7 + ุฑูู ุงูุญุณุงุจ ุงููุงูู)
- ุงุณู: ุจูู ุณุงุจ ูุฒูู
- transaction_type: 'gold'
- tracks_weight: True
```

### 2๏ธโฃ ุงูุญุณุงุจ ุงููุฒูู โ ุงููุงูู

```python
ุญุณุงุจ ูุฒูู:
- ุฑูู: 7180
- ุงุณู: ุจูู ุงูุฃูู ูุฒูู
- transaction_type: 'gold'

        โฌ๏ธ ุฅูุดุงุก ุชููุงุฆู

ุญุณุงุจ ูุงูู:
- ุฑูู: 180  (ุญุฐู ุงูู 7 ูู ุงูุจุฏุงูุฉ)
- ุงุณู: ุจูู ุงูุฃูู (ุญุฐู ูููุฉ "ูุฒูู")
- transaction_type: 'cash'
- tracks_weight: False
```

---

## ๐๏ธ ุงูุชุทุจูู

### ุงูุชุนุฏููุงุช ุนูู `models.py`

ุชู ุฅุถุงูุฉ ุฏุงูุฉ `create_parallel_account()` ูู ููุงุณ `Account`:

```python
def create_parallel_account(self):
    """
    ุฅูุดุงุก ุญุณุงุจ ููุงุฒู ุชููุงุฆูุงู
    
    Returns:
        Account: ุงูุญุณุงุจ ุงูููุงุฒู ุงููููุดุฃ ุฃู None
    """
    # ุชุญุฏูุฏ ุงุชุฌุงู ุงูุฅูุดุงุก (ูุงููโูุฒูู ุฃู ูุฒููโูุงูู)
    # ุฅูุดุงุก ุฑูู ูุงุณู ุงูุญุณุงุจ ุงูููุงุฒู
    # ุงูุจุญุซ ุนู ุงูุญุณุงุจ ุงูุฃุจ ุงูููุงุฒู
    # ุฅูุดุงุก ุงูุญุณุงุจ ูุฑุจุทู
```

**ุงูููุฒุงุช:**
- โ ุชุญุงูุธ ุนูู ุงูุนูุงูุงุช ุงููุฑููุฉ (parent_id)
- โ ุชูุณุฎ ููุน ุงูุญุณุงุจ (Asset, Liability, Revenue, Expense)
- โ ุชุฑุจุท ุงูุญุณุงุจูู ุนุจุฑ `memo_account_id`

---

### ุงูุชุนุฏููุงุช ุนูู `routes.py`

ุชู ุชุญุฏูุซ endpoint ุฅุถุงูุฉ ุงูุญุณุงุจุงุช:

```python
@api.route('/accounts', methods=['POST'])
def add_account():
    """ุฅุถุงูุฉ ุญุณุงุจ ุฌุฏูุฏ ูุน ุฅูุดุงุก ุญุณุงุจ ููุงุฒู ุชููุงุฆูุงู"""
    
    # ุฅูุดุงุก ุงูุญุณุงุจ ุงูุฃุณุงุณู
    new_account = Account(...)
    
    # ุฅูุดุงุก ุงูุญุณุงุจ ุงูููุงุฒู ุชููุงุฆูุงู
    if data.get('create_parallel', True):
        parallel_account = new_account.create_parallel_account()
    
    # ุฅุฑุฌุงุน ูุนูููุงุช ุงูุญุณุงุจ + ุงูุญุณุงุจ ุงูููุงุฒู
    result['parallel_account'] = {...}
```

**ููุงุญุธุฉ:** ูููู ุชุนุทูู ุงูุฅูุดุงุก ุงูุชููุงุฆู ุนุจุฑ `create_parallel=False` ูู ุงูุทูุจ.

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### 1๏ธโฃ ุนุจุฑ API

#### ุฅุถุงูุฉ ุญุณุงุจ ูุงูู:

```bash
POST /api/accounts
Content-Type: application/json

{
  "account_number": "1190",
  "name": "ุจูู ุงูุฑูุงุถ",
  "type": "Asset",
  "transaction_type": "cash",
  "parent_id": null,
  "tracks_weight": false
}
```

**ุงููุชูุฌุฉ:**
```json
{
  "id": 75,
  "account_number": "1190",
  "name": "ุจูู ุงูุฑูุงุถ",
  "transaction_type": "cash",
  "parallel_account": {
    "id": 76,
    "account_number": "71190",
    "name": "ุจูู ุงูุฑูุงุถ ูุฒูู",
    "transaction_type": "gold"
  }
}
```

#### ุฅุถุงูุฉ ุญุณุงุจ ูุฒูู:

```bash
POST /api/accounts
Content-Type: application/json

{
  "account_number": "7200",
  "name": "ุนููุงุก ุงูุชุฌุฒุฆุฉ ูุฒูู",
  "type": "Asset",
  "transaction_type": "gold",
  "parent_id": null,
  "tracks_weight": true
}
```

**ุงููุชูุฌุฉ:**
```json
{
  "id": 77,
  "account_number": "7200",
  "name": "ุนููุงุก ุงูุชุฌุฒุฆุฉ ูุฒูู",
  "transaction_type": "gold",
  "parallel_account": {
    "id": 78,
    "account_number": "200",
    "name": "ุนููุงุก ุงูุชุฌุฒุฆุฉ",
    "transaction_type": "cash"
  }
}
```

---

### 2๏ธโฃ ุนุจุฑ ุงูููุฏ ุงููุจุงุดุฑ

```python
from app import app, db
from models import Account

with app.app_context():
    # ุฅูุดุงุก ุญุณุงุจ ูุงูู
    financial = Account(
        account_number="1200",
        name="ุจูู ุงูุณุนูุฏู ุงููุฑูุณู",
        type="Asset",
        transaction_type="cash"
    )
    db.session.add(financial)
    db.session.flush()
    
    # ุฅูุดุงุก ุงูุญุณุงุจ ุงูููุงุฒู ุชููุงุฆูุงู
    parallel = financial.create_parallel_account()
    
    print(f"ูุงูู: {financial.account_number}")
    print(f"ูุฒูู: {parallel.account_number}")
    print(f"ูุฑุจูุท: {financial.memo_account_id == parallel.id}")
    
    db.session.commit()
```

---

## ๐ ุงูุฑุจุท ุงูุชููุงุฆู

### ููู ูุนููุ

ุนูุฏ ุฅูุดุงุก ุญุณุงุจ ูุงูู:
```python
financial.memo_account_id = parallel_account.id
```

ุนูุฏ ุฅูุดุงุก ุญุณุงุจ ูุฒูู:
```python
parallel_account.memo_account_id = gold_account.id
```

### ุงูุชุญูู ูู ุงูุฑุจุท:

```python
# ูู ุงููุงูู ุฅูู ุงููุฒูู
financial = Account.query.filter_by(account_number="1170").first()
memo = Account.query.get(financial.memo_account_id)
print(f"{financial.name} โ {memo.name}")

# ูู ุงููุฒูู ุฅูู ุงููุงูู
gold = Account.query.filter_by(account_number="7180").first()
cash = Account.query.get(gold.memo_account_id)
print(f"{gold.name} โ {cash.name}")
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุชุดุบูู ุงูุณูุฑุจุช ุงูุงุฎุชุจุงุฑู:

```bash
cd backend
source venv/bin/activate

# ุงุฎุชุจุงุฑ ูุจุงุดุฑ
python test_parallel_accounts.py

# ุงุฎุชุจุงุฑ ุนุจุฑ API (ูุชุทูุจ ุชุดุบูู ุงูุณูุฑูุฑ)
python test_parallel_accounts.py api
```

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ:

```
======================================================================
๐งช ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงูููุงุฒูุฉ ูุจุงุดุฑุฉ
======================================================================

1๏ธโฃ ุฅูุดุงุก ุญุณุงุจ ูุงูู...
   โ ุชู ุฅูุดุงุก: 1170 - ุจูู ุณุงุจ
   โ ุงูุญุณุงุจ ุงูููุงุฒู: 71170 - ุจูู ุณุงุจ ูุฒูู
   ๐ memo_account_id: 76

2๏ธโฃ ุฅูุดุงุก ุญุณุงุจ ูุฒูู...
   โ ุชู ุฅูุดุงุก: 7180 - ุจูู ุงูุฃูู ูุฒูู
   โ ุงูุญุณุงุจ ุงูููุงุฒู: 180 - ุจูู ุงูุฃูู

3๏ธโฃ ุงูุชุญูู ูู ุงูุฑุจุท...
   โ ุงูุญุณุงุจ ุงููุงูู 1170 ูุฑุจูุท ุจู 71170

======================================================================
๐ ููุฎุต ุงูุญุณุงุจุงุช ุงูููุดุฃุฉ:
======================================================================
   1170   | ุจูู ุณุงุจ                        | cash  ๐ 71170
   180    | ุจูู ุงูุฃูู                      | cash  ๐ 7180
   7180   | ุจูู ุงูุฃูู ูุฒูู                 | gold 
```

---

## โ๏ธ ุงูุฎูุงุฑุงุช ุงููุชูุฏูุฉ

### ุชุนุทูู ุงูุฅูุดุงุก ุงูุชููุงุฆู

ูู ุญุงู ุงูุฑุบุจุฉ ุจุฅูุดุงุก ุญุณุงุจ **ุจุฏูู** ุญุณุงุจ ููุงุฒู:

```json
POST /api/accounts

{
  "account_number": "9999",
  "name": "ุญุณุงุจ ุฎุงุต",
  "type": "Asset",
  "transaction_type": "cash",
  "create_parallel": false
}
```

### ุงูุญุณุงุจุงุช ุงูุชู **ูุง** ุชููุดุฆ ุญุณุงุจ ููุงุฒู:

1. **ุญุณุงุจุงุช `transaction_type='both'`**: ูุง ุชุญุชุงุฌ ุญุณุงุจ ููุงุฒู
2. **ุญุณุงุจุงุช ูุฒููุฉ ูุง ุชุจุฏุฃ ุจู 7**: ูุง ูููู ุงุณุชุฎุฑุงุฌ ุฑูู ูุงูู ุตุญูุญ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

ุจุนุฏ ุชุทุจูู ุงููุธุงู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ:

```python
with app.app_context():
    total = Account.query.count()
    cash = Account.query.filter_by(transaction_type='cash').count()
    gold = Account.query.filter_by(transaction_type='gold').count()
    linked = Account.query.filter(Account.memo_account_id.isnot(None)).count()
    
    print(f"ุฅุฌูุงูู ุงูุญุณุงุจุงุช: {total}")
    print(f"ุญุณุงุจุงุช ูุงููุฉ: {cash}")
    print(f"ุญุณุงุจุงุช ูุฒููุฉ: {gold}")
    print(f"ุญุณุงุจุงุช ูุฑุจูุทุฉ: {linked}")
```

**ุงููุชูุฌุฉ ุงูุญุงููุฉ:**
```
ุฅุฌูุงูู ุงูุญุณุงุจุงุช: 74
ุญุณุงุจุงุช ูุงููุฉ: 37
ุญุณุงุจุงุช ูุฒููุฉ: 37
ุญุณุงุจุงุช ูุฑุจูุทุฉ: 33
```

---

## โ ุงูููุฎุต

- โ **ุฅูุดุงุก ุชููุงุฆู** ููุญุณุงุจุงุช ุงูููุงุฒูุฉ ูู ุงูุงุชุฌุงููู
- โ **ุฑุจุท ุชููุงุฆู** ุนุจุฑ `memo_account_id`
- โ **ุญูุธ ุงูุนูุงูุงุช ุงููุฑููุฉ** (parent_id)
- โ **ุชุณููุฉ ุฐููุฉ** ("ุจูู ุงูุฑูุงุถ" โ "ุจูู ุงูุฑูุงุถ ูุฒูู")
- โ **ุชุฑููู ููุทูู** (1170 โ 71170)
- โ **ุงุฎุชุจุงุฑ ุดุงูู** ุนุจุฑ ุณูุฑุจุช ูุฎุตุต

---

**ุชุงุฑูุฎ ุงูุชุทุจูู:** ุฏูุณูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ  
**ุงููููุงุช ุงููุนุฏูุฉ:**
- `backend/models.py`: ุฅุถุงูุฉ `create_parallel_account()`
- `backend/routes.py`: ุชุญุฏูุซ `POST /api/accounts`
- `backend/test_parallel_accounts.py`: ุณูุฑุจุช ุงูุงุฎุชุจุงุฑ
