# 📋 شكل حجز الذهب في النظام المزدوج - الشرح الكامل

## 🎯 السيناريو

```
المكتب: مكتب الذهب الملكي
الوزن المحجوز: 100 جرام (عيار 21)
المبلغ المدفوع: 40,000 ريال
سعر الذهب: 400 ريال/جرام
```

---

## 🔥 القيد المحاسبي

### الكود:

```python
from dual_system_helpers import create_dual_entry_with_memo

entry = create_dual_entry_with_memo(
    description='حجز ذهب من مكتب الذهب الملكي',
    entries=[
        {'account_code': '1290', 'debit': 40000, 'debit_weight': 100},
        {'account_code': '21110', 'credit': 40000, 'credit_weight': 100}
    ],
    gold_price=400,
    posted=True
)
```

---

## 📊 النتيجة: 4 سطور تلقائياً

### السطر 1️⃣: الحساب المالي المدين

```
┌─────────────────────────────────────────────────────────┐
│ 🟢 حساب مالي (يظهر في الميزانية)                      │
├─────────────────────────────────────────────────────────┤
│ الحساب: [1290] جسر مشتريات الكسر والتسكير             │
│ النوع: Asset (أصل)                                     │
│                                                         │
│ 💰 النقد:                                              │
│    • مدين: 40,000 ريال ✅                              │
│                                                         │
│ ⚖️  الوزن:                                             │
│    • --- (لا يحمل وزن) ❌                              │
│                                                         │
│ 💵 سعر الذهب المحفوظ: 400 ريال/جرام                   │
└─────────────────────────────────────────────────────────┘
```

### السطر 2️⃣: حساب المذكرة المدين

```
┌─────────────────────────────────────────────────────────┐
│ 🔵 حساب مذكرة (خارج الميزانية)                        │
├─────────────────────────────────────────────────────────┤
│ الحساب: [71290] جسر مشتريات (وزن)                     │
│ النوع: Memo (مذكرة)                                    │
│                                                         │
│ 💰 النقد:                                              │
│    • --- (لا يحمل نقد) ❌                              │
│                                                         │
│ ⚖️  الوزن:                                             │
│    • مدين: 100 جرام ✅                                 │
│                                                         │
│ 💵 سعر الذهب المحفوظ: 400 ريال/جرام                   │
└─────────────────────────────────────────────────────────┘
```

### السطر 3️⃣: الحساب المالي الدائن

```
┌─────────────────────────────────────────────────────────┐
│ 🟢 حساب مالي (يظهر في الميزانية)                      │
├─────────────────────────────────────────────────────────┤
│ الحساب: [21110] مكاتب التسكير                         │
│ النوع: Liability (التزام)                             │
│                                                         │
│ 💰 النقد:                                              │
│    • دائن: 40,000 ريال ✅                              │
│                                                         │
│ ⚖️  الوزن:                                             │
│    • --- (لا يحمل وزن) ❌                              │
│                                                         │
│ 💵 سعر الذهب المحفوظ: 400 ريال/جرام                   │
└─────────────────────────────────────────────────────────┘
```

### السطر 4️⃣: حساب المذكرة الدائن

```
┌─────────────────────────────────────────────────────────┐
│ 🔵 حساب مذكرة (خارج الميزانية)                        │
├─────────────────────────────────────────────────────────┤
│ الحساب: [72110] مكاتب التسكير (وزن)                   │
│ النوع: Memo (مذكرة)                                    │
│                                                         │
│ 💰 النقد:                                              │
│    • --- (لا يحمل نقد) ❌                              │
│                                                         │
│ ⚖️  الوزن:                                             │
│    • دائن: 100 جرام ✅                                 │
│                                                         │
│ 💵 سعر الذهب المحفوظ: 400 ريال/جرام                   │
└─────────────────────────────────────────────────────────┘
```

---

## 📈 التأثير على الحسابات

### 🟢 الحسابات المالية (تظهر في الميزانية):

```
من ح/ 1290 جسر المشتريات        40,000 ريال (مدين)
إلى ح/ 21110 مكاتب التسكير       40,000 ريال (دائن)
```

**الميزانية:**
- الأصول ← زادت بـ 40,000 ريال (جسر المشتريات)
- الخصوم ← زادت بـ 40,000 ريال (التزام للمكتب)

### 🔵 حسابات المذكرة (لا تظهر في الميزانية):

```
من ح/ 71290 جسر المشتريات (وزن)   100 جرام (مدين)
إلى ح/ 72110 مكاتب التسكير (وزن)  100 جرام (دائن)
```

**التقارير الوزنية:**
- الأصول الوزنية ← زادت بـ 100 جرام
- الالتزامات الوزنية ← زادت بـ 100 جرام

---

## 🔍 كيف تظهر في التقارير؟

### 1. الميزانية العمومية (Balance Sheet):

```
الأصول:
├─ أصول متداولة
│  └─ جسر المشتريات (1290)       40,000 ريال ✅
│
الخصوم:
└─ التزامات قصيرة الأجل
   └─ مكاتب التسكير (21110)      40,000 ريال ✅
```

**ملاحظة:** حسابات المذكرة (7xxx) **لا تظهر** في الميزانية

### 2. التقرير الوزني:

```
GET /api/dual_system/account_statement?account_id=<71290>

الأصول الوزنية:
├─ جسر المشتريات (وزن)
│  └─ الرصيد: 100 جرام ✅
│
الالتزامات الوزنية:
└─ مكاتب التسكير (وزن)
   └─ الرصيد: 100 جرام ✅
```

### 3. كشف الحساب المزدوج:

```
GET /api/dual_system/account_statement?account_id=<1290>

[1290] جسر المشتريات:
──────────────────────────────────────────────
التاريخ       | النقد   | الوزن
──────────────────────────────────────────────
2025-12-02   | +40,000 | ---
الرصيد       | 40,000  | ---
```

```
GET /api/dual_system/account_statement?account_id=<71290>

[71290] جسر المشتريات (وزن):
──────────────────────────────────────────────
التاريخ       | النقد   | الوزن
──────────────────────────────────────────────
2025-12-02   | ---     | +100g
الرصيد       | ---     | 100g
```

---

## 💡 الفوائد

### 1. الفصل الواضح:

```
✅ الحسابات المالية = المحاسبة التقليدية (نقد)
✅ حسابات المذكرة = التتبع الوزني (جرامات)
```

### 2. عدم التداخل:

```
❌ لا يوجد ازدواجية في شجرة الحسابات المالية
❌ لا تؤثر حسابات المذكرة على الميزانية
❌ لا يوجد تضخم في الأرصدة
```

### 3. تقارير منفصلة:

```
📊 التقارير المالية ← تستخدم الحسابات (1-6)
📊 التقارير الوزنية ← تستخدم حسابات المذكرة (7)
```

---

## 🎯 ملخص القاعدة

```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│  كل معاملة = 4 سطور:                                   │
│                                                          │
│  1️⃣ حساب مالي مدين → نقد فقط                          │
│  2️⃣ حساب مذكرة مدين → وزن فقط                         │
│  3️⃣ حساب مالي دائن → نقد فقط                          │
│  4️⃣ حساب مذكرة دائن → وزن فقط                         │
│                                                          │
│  ✅ الحسابات المالية: نقد فقط (تظهر في الميزانية)     │
│  ✅ حسابات المذكرة: أوزان فقط (خارج الميزانية)         │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 🚀 الاستخدام

```python
# في كود حجوزات المكاتب
from dual_system_helpers import create_dual_entry_with_memo

entry = create_dual_entry_with_memo(
    description=f'حجز من {office_name}',
    entries=[
        {
            'account_code': '1290',       # جسر المشتريات
            'debit': paid_amount,         # المبلغ النقدي
            'debit_weight': reserved_weight  # الوزن الفعلي
        },
        {
            'account_code': '21110',      # مكاتب التسكير
            'credit': paid_amount,        # المبلغ النقدي
            'credit_weight': reserved_weight  # الوزن الفعلي
        }
    ],
    reference_type='office_reservation',
    reference_id=reservation.id,
    gold_price=current_gold_price,
    posted=True
)
```

---

**تاريخ التحديث:** 2 ديسمبر 2025  
**الحالة:** ✅ مصحح ونهائي
