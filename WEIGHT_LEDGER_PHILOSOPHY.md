# ููุณูุฉ ุงููุธุงู ุงููุญุงุณุจู ุงููุฒูู
## Weight Ledger System Philosophy

> **ุงููุฏู ุงูุฃุณุงุณู**: ูุธุงู ูุญุงุณุจู ูุฒุฏูุฌ ูุชุชุจุน ุงููููุฉ ุงูููุฏูุฉ **ูุงููุฒู ุงูุฐูุจู** ููู ุนูููุฉ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ุงููุดููุฉ ุงูุชู ูุญููุง](#ุงููุดููุฉ-ุงูุชู-ูุญููุง)
2. [ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ (Golden Rule)](#ุงููุงุนุฏุฉ-ุงูุฐูุจูุฉ-golden-rule)
3. [ุงูุงุณุชุซูุงุก ุงููุญูุฏ: ุงููุฎุฒูู](#ุงูุงุณุชุซูุงุก-ุงููุญูุฏ-ุงููุฎุฒูู)
4. [ููุงุฐุง ุงูุฑุจุญ ุงููุฒูู ููุณ ููุฏุงู ูุญุงุณุจูุงูุ](#ููุงุฐุง-ุงูุฑุจุญ-ุงููุฒูู-ููุณ-ููุฏุงู-ูุญุงุณุจูุงู)
5. [ุงูุชุตููู ุงูุชููู](#ุงูุชุตููู-ุงูุชููู)
6. [ุฃูุซูุฉ ุนูููุฉ](#ุฃูุซูุฉ-ุนูููุฉ)
7. [ุงูููุงุนุฏ ุงูุฅูุฒุงููุฉ](#ุงูููุงุนุฏ-ุงูุฅูุฒุงููุฉ)
8. [ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ](#ุงูุฃุฎุทุงุก-ุงูุดุงุฆุนุฉ)

---

## ุงููุดููุฉ ุงูุชู ูุญููุง

### ๐ด ุงููุดููุฉ
ูู ุชุฌุงุฑุฉ ุงูุฐูุจุ **ุงููููุฉ ุงูููุฏูุฉ** ูุถููุฉ:
- ุณุนุฑ ุงูุฐูุจ ูุชุบูุฑ ููููุงู
- ุงูุฑุจุญ ุงูููุฏู ูุฏ ูููู ุฎุณุงุฑุฉ ูุฒููุฉ (ูุงูุนูุณ ุตุญูุญ)
- ุงููุตุฑููุงุช ุงูุชุดุบูููุฉ ุชููู ุงูููุฉ ุงูุดุฑุงุฆูุฉ ููุดุฑูุฉ ุจุงูุฐูุจ

**ูุซุงู ูุงูุนู**:
```
ููุงูุฑ:  ุฑุจุญ 10,000 ุฑูุงู (ุณุนุฑ ุงูุฌุฑุงู 400 ุฑูุงู) = 25 ุฌุฑุงู ุฐูุจ
ูุจุฑุงูุฑ: ุฑุจุญ 12,000 ุฑูุงู (ุณุนุฑ ุงูุฌุฑุงู 500 ุฑูุงู) = 24 ุฌุฑุงู ุฐูุจ

โ ูุญุงุณุจูุงู: ููู 20%
โ ูุฒููุงู: ุฎุณุงุฑุฉ 1 ุฌุฑุงู (-4%)
```

### ๐ข ุงูุญู
**ุฏูุชุฑ ูุฒูู ููุงุฒู** ูุญูู ูู ูููุฉ ููุฏูุฉ ุฅูู ูุฒู ุฐูุจ ุญุณุจ ุงูุณุนุฑ ุงููุจุงุดุฑ.

---

## ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ (Golden Rule)

### ๐ ุงููุจุฏุฃ ุงูุฃุณุงุณู
```
ูู ุฑูุงู ูุฏุฎู ุฃู ูุฎุฑุฌ โ ููุญูู ููุฑุงู ุฅูู ูุฒู ุฐูุจ
```

### ๐ข ุงููุนุงุฏูุฉ
```python
ุงููุฒู ุงููุนุงุฏู (ุฌุฑุงู) = ุงููุจูุบ ุงูููุฏู (ุฑูุงู) รท ุงูุณุนุฑ ุงููุจุงุดุฑ ููุฐูุจ ุนูุงุฑ 24
```

### ๐ ูุชู ุชูุทุจูุ
โ **ูุนู** โ ุชูุทุจู ุนูู:
- ุงูุฅูุฑุงุฏุงุช (ูุจูุนุงุช)
- ุงููุตุฑููุงุช (ุฅูุฌุงุฑุ ุฑูุงุชุจุ ููุฑุจุงุก)
- ุงูููุจูุถุงุช ูุงููุฏููุนุงุช
- ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ

โ **ูุง** โ **ูุง** ุชูุทุจู ุนูู:
- **ุงููุฎุฒูู ุงูุฐูุจู ููุท** (ูู ูุงุนุฏุฉ ุฎุงุตุฉ - ุงูุธุฑ ุงูุงุณุชุซูุงุก ุฃุฏูุงู)

---

## ุงูุงุณุชุซูุงุก ุงููุญูุฏ: ุงููุฎุฒูู

### ๐ ูุงุนุฏุฉ ุงููุฎุฒูู ุงูุฐูุจู
```
ุงููุฎุฒูู = ุงููุฒู ุงููุนูู (ุจุฏูู ุชุญููู)
```

### ๐ ููุงุฐุงุ
ูุฃู ุงููุฎุฒูู **ุฐูุจ ุญูููู**:
- ุนูุฏูุง ูุดุชุฑู 100 ุฌุฑุงู โ **ูุนูุงู** ูุฏููุง 100 ุฌุฑุงู
- ุนูุฏูุง ูุจูุน 50 ุฌุฑุงู โ **ูุนูุงู** ูุฎุฑุฌ 50 ุฌุฑุงู

**ุงูููุฏ ุงููุญุงุณุจู**:
```
# ุดุฑุงุก ูุฎุฒูู 100 ุฌุฑุงู ุจู 40,000 ุฑูุงู

ุงูุฏูุชุฑ ุงููุงูู:
    ูู ุญู/ ุงููุฎุฒูู (ูููุฉ)         40,000 ุฑูุงู
        ุฅูู ุญู/ ุงูููุฏูุฉ            40,000 ุฑูุงู

ุงูุฏูุชุฑ ุงููุฒูู:
    ูู ุญู/ ุงููุฎุฒูู (ูุฒู ูุนูู)    100 ุฌุฑุงู     โ ุงุณุชุซูุงุก
        ุฅูู ุญู/ ุงูููุฏูุฉ (ูุฒู ูุญุณูุจ)  93 ุฌุฑุงู   โ ุชุทุจูู ุงููุงุนุฏุฉ
```

> ๐ก **ุงููุฑู**: ุงูููุฏูุฉ ุชูุญูู ุญุณุจ ุงูุณุนุฑ ุงููุจุงุดุฑ (430 ุฑูุงู/ุฌุฑุงู) โ 93 ุฌุฑุงู  
> ููู ุงููุฎุฒูู ููุณุฌู ุจุงููุฒู **ุงููุนูู** โ 100 ุฌุฑุงู

---

## ููุงุฐุง ุงูุฑุจุญ ุงููุฒูู ููุณ ููุฏุงู ูุญุงุณุจูุงูุ

### โ ุฎุทุฃ ุดุงุฆุน
```python
# โ๏ธ ุฎุทุฃ: ุฅูุดุงุก ููุฏ "ุฑุจุญ ูุฒูู"
ูู ุญู/ ุชูููุฉ ุงููุจูุนุงุช (ูุฒู)    10 ุฌุฑุงู
    ุฅูู ุญู/ ุงูุฑุจุญ ุงููุฒูู         10 ุฌุฑุงู
```

### โ ุงูุตุญูุญ
ุงูุฑุจุญ ุงููุฒูู **ููุญุณุจ** ูู ุงูุชูุงุฑูุฑ ููุท:

```python
# ูู ุงูุชูุงุฑูุฑ ููุท
profit_weight = net_profit_cash / direct_gold_price

# ูุซุงู:
# ุตุงูู ุงูุฑุจุญ ุงูููุฏู = 4,300 ุฑูุงู
# ุงูุณุนุฑ ุงููุจุงุดุฑ = 430 ุฑูุงู/ุฌุฑุงู
# ุงูุฑุจุญ ุงููุฒูู = 4,300 รท 430 = 10 ุฌุฑุงู
```

### ๐ค ููุงุฐุงุ
1. **ุงูุฑุจุญ ููุณ ููุงูุงู ูุณุชููุงู** โ ูู **ูุชูุฌุฉ** ุงููุฑู ุจูู ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช
2. **ุงููููุฏ ุงููุฒููุฉ ููุฌูุฏุฉ ูุนูุงู**:
   - ุฅูุฑุงุฏุงุช ูุฒููุฉ (ุฏุงุฆู)
   - ุชูููุฉ ูุฒููุฉ (ูุฏูู)
   - ุงููุฑู = ุงูุฑุจุญ ุงููุฒูู (ููุญุณุจ ุชููุงุฆูุงู)
3. **ููุฏ ุฅุถุงูู = ุงุฒุฏูุงุฌูุฉ** โ ูุฎู ุจุงูุชูุงุฒู

---

## ุงูุชุตููู ุงูุชููู

### 1๏ธโฃ ูุญุฑู ุงูููุงุนุฏ (Rule Engine)
**ุงููููุน**: `backend/services/weight_ledger_service.py`

**ุงููุณุคูููุงุช**:
```python
class WeightLedgerService:
    def should_create_weight_entry(account) โ bool
    def convert_amount_to_weight(amount, karat) โ float
    def is_inventory_account(account) โ bool
    def validate_weight_balance(journal_entry_id) โ (bool, dict)
```

### 2๏ธโฃ ููุน ุงููุฒู (Weight Type)
ูู ููุฏ ูุฒูู ูู ููุน:

| ุงูููุน | ุงูุงุณุชุฎุฏุงู | ูุซุงู |
|------|----------|------|
| `PHYSICAL` | ูุฒู ูุนูู (ูุฎุฒูู) | ุดุฑุงุก/ุจูุน ุฐูุจ |
| `ANALYTICAL` | ูุฒู ูุญุณูุจ (ุชุญูููู) | ุฅูุฑุงุฏุงุชุ ูุตุฑููุงุช |

```python
# ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
class JournalEntryLine:
    weight_type = db.Column(db.String(20), default='ANALYTICAL')
```

### 3๏ธโฃ Snapshot ุงูุณุนุฑ
ูุฎุฒู ุงูุณุนุฑ **ููุช ุงูุนูููุฉ** ูุถูุงู ุฏูุฉ ุงูุชูุงุฑูุฑ ุงูุชุงุฑูุฎูุฉ:

```python
journal_entry.gold_price_snapshot = 430.50  # ุฑูุงู/ุฌุฑุงู ุนูุงุฑ 24
journal_entry.price_source = "manual"  # or "api"
journal_entry.price_timestamp = datetime.now()
```

### 4๏ธโฃ ุงูุชุญูู ุงูุฅูุฒุงูู (Fail Fast)
```python
# ูู dual_system_helpers.py
is_balanced, details = verify_dual_balance(journal_entry.id)

if not is_balanced:
    raise WeightImbalanceError("Weight ledger imbalanced!")
```

---

## ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุจูุน ุฐูุจ
```python
# ุจูุน ุณูุณูุฉ 21 ููุฑุงุท ูุฒู 50 ุฌุฑุงู ุจู 21,500 ุฑูุงู
# ุงูุณุนุฑ ุงููุจุงุดุฑ: 430 ุฑูุงู/ุฌุฑุงู (24 ููุฑุงุท)

# 1. ุงูุฏูุชุฑ ุงููุงูู
ูู ุญู/ ุงูููุฏูุฉ (cash)           21,500 ุฑูุงู
    ุฅูู ุญู/ ุงูุฅูุฑุงุฏุงุช (cash)      21,500 ุฑูุงู

ูู ุญู/ ุชูููุฉ ุงููุจูุนุงุช (cash)    18,000 ุฑูุงู
    ุฅูู ุญู/ ุงููุฎุฒูู (cash)        18,000 ุฑูุงู

# 2. ุงูุฏูุชุฑ ุงููุฒูู
# ุงูููุฏูุฉ (ุชุญููู)
ูู ุญู/ ุงูููุฏูุฉ (weight)          50.00 ุฌุฑุงู  โ 21,500 รท 430 = ANALYTICAL
    ุฅูู ุญู/ ุงูุฅูุฑุงุฏุงุช (weight)     50.00 ุฌุฑุงู  โ ANALYTICAL

# ุงููุฎุฒูู (ูุฒู ูุนูู)
ูู ุญู/ ุชูููุฉ ุงููุจูุนุงุช (weight)   50.00 ุฌุฑุงู  โ PHYSICAL (actual)
    ุฅูู ุญู/ ุงููุฎุฒูู (weight)       50.00 ุฌุฑุงู  โ PHYSICAL (actual)

# 3. ุงูุฑุจุญ ุงููุฒูู (ูุญุณูุจ ูู ุงูุชูุฑูุฑ ููุท)
profit_cash = 21,500 - 18,000 = 3,500 ุฑูุงู
profit_weight = 3,500 รท 430 = 8.14 ุฌุฑุงู  # โ ูุง ููุณุฌู ูููุฏ!
```

### ูุซุงู 2: ูุตุฑูู ุฅูุฌุงุฑ
```python
# ุฅูุฌุงุฑ ูุญู ุดูุฑู 10,000 ุฑูุงู
# ุงูุณุนุฑ ุงููุจุงุดุฑ: 430 ุฑูุงู/ุฌุฑุงู (24 ููุฑุงุท)

# 1. ุงูุฏูุชุฑ ุงููุงูู
ูู ุญู/ ูุตุฑูู ุงูุฅูุฌุงุฑ (cash)      10,000 ุฑูุงู
    ุฅูู ุญู/ ุงูููุฏูุฉ (cash)         10,000 ุฑูุงู

# 2. ุงูุฏูุชุฑ ุงููุฒูู (ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ)
ูู ุญู/ ูุตุฑูู ุงูุฅูุฌุงุฑ (weight)     23.26 ุฌุฑุงู  โ 10,000 รท 430 = ANALYTICAL
    ุฅูู ุญู/ ุงูููุฏูุฉ (weight)        23.26 ุฌุฑุงู  โ ANALYTICAL

# ๐ก ูุนูู: ุงูุดุฑูุฉ "ุฎุณุฑุช" 23.26 ุฌุฑุงู ููุฉ ุดุฑุงุฆูุฉ ุจุณุจุจ ูุฐุง ุงููุตุฑูู
```

### ูุซุงู 3: ุดุฑุงุก ูุฎุฒูู
```python
# ุดุฑุงุก ุฐูุจ ูุณุฑ 100 ุฌุฑุงู (24 ููุฑุงุท) ุจู 43,000 ุฑูุงู
# ุงูุณุนุฑ ุงููุจุงุดุฑ: 430 ุฑูุงู/ุฌุฑุงู

# 1. ุงูุฏูุชุฑ ุงููุงูู
ูู ุญู/ ุงููุฎุฒูู (cash)            43,000 ุฑูุงู
    ุฅูู ุญู/ ุงูููุฏูุฉ (cash)         43,000 ุฑูุงู

# 2. ุงูุฏูุชุฑ ุงููุฒูู
# ุงููุฎุฒูู = ูุฒู ูุนูู (ุงุณุชุซูุงุก)
ูู ุญู/ ุงููุฎุฒูู (weight)           100.00 ุฌุฑุงู  โ PHYSICAL (actual weight)
    ุฅูู ุญู/ ุงูููุฏูุฉ (weight)        100.00 ุฌุฑุงู  โ ANALYTICAL (converted)

# โ ููุง ุชุทุงุจูุช ุงููููุฉ ุงููุฒููุฉ ุจุงูุตุฏูุฉ (100 ุฌุฑุงู = 100 ุฌุฑุงู)
# ูุฃู ุณุนุฑ ุงูุดุฑุงุก = ุงูุณุนุฑ ุงููุจุงุดุฑ (430 ร 100 = 43,000)
```

---

## ุงูููุงุนุฏ ุงูุฅูุฒุงููุฉ

### โ ุงูุนู
1. **ุงุณุชุฎุฏู `WeightLedgerService`** ุฏุงุฆูุงู ูุฅูุดุงุก ูููุฏ ูุฒููุฉ
2. **ุชุญูู ูู ุงูุชูุงุฒู** ุจุนุฏ ูู ุนูููุฉ โ `verify_dual_balance()`
3. **ุณุฌู ููุน ุงููุฒู** โ `weight_type = 'PHYSICAL'` ุฃู `'ANALYTICAL'`
4. **ุงุญูุธ snapshot ุงูุณุนุฑ** โ `gold_price_snapshot`
5. **ุงุญุณุจ ุงูุฑุจุญ ุงููุฒูู ูู ุงูุชูุงุฑูุฑ** ููุท

### โ ูุง ุชูุนู
1. **ูุง ุชูุดุฆ ูููุฏ ูุฒููุฉ ูุฏููุงู** โ ุงุณุชุฎุฏู `create_dual_journal_entry()`
2. **ูุง ุชุทุจู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ุนูู ุงููุฎุฒูู** โ ุงุณุชุฎุฏู ุงููุฒู ุงููุนูู
3. **ูุง ุชูุณุฌู ุงูุฑุจุญ ุงููุฒูู ูููุฏ** โ ุงุญุณุจู ูู ุงูุชูุงุฑูุฑ
4. **ูุง ุชุนุชูุฏ ุนูู ุงูุณุนุฑ ุงูุญุงูู** ูู ุงูุชูุงุฑูุฑ ุงูุชุงุฑูุฎูุฉ โ ุงุณุชุฎุฏู `gold_price_snapshot`
5. **ูุง ุชุชุฌุงูู ุฃุฎุทุงุก ุงูุชูุงุฒู** โ ุงููุธุงู ูุฌุจ ุฃู ูุฑูุถ ุงููููุฏ ุบูุฑ ุงููุชูุงุฒูุฉ

---

## ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### โ ุฎุทุฃ 1: ุชุญููู ุงููุฎุฒูู ูุฑุชูู
```python
# ุฎุทุฃ
inventory_cash = 40,000
inventory_weight = 100  # actual
converted_weight = inventory_cash / gold_price  # โ ุฎุทุฃ! ุชุญููู ุซุงู

# ุตุญูุญ
inventory_cash = 40,000
inventory_weight = 100  # ุงุณุชุฎุฏู ุงููุฒู ุงููุนูู ูุจุงุดุฑุฉ (PHYSICAL)
```

### โ ุฎุทุฃ 2: ููุฏ ุฏุงุฆู ุจุฏูู ูุฏูู (ุฃู ุงูุนูุณ)
```python
# ุฎุทุฃ: ููุฏ ูููุฑุฏ
create_dual_journal_entry(
    account_id=revenue_account,
    cash_credit=1000,
    # โ ุฃูู ุงูุทุฑู ุงููุฏููุ
)

# ุตุญูุญ: ููุฏุงู ูุชูุงุฒูุงู
create_dual_journal_entry(
    account_id=cash_account,
    cash_debit=1000
)
create_dual_journal_entry(
    account_id=revenue_account,
    cash_credit=1000
)
```

### โ ุฎุทุฃ 3: ูุณูุงู ุชุญุฏูุฏ `weight_type`
```python
# ุฎุทุฃ
line.debit_24k = 100  # ูู ูุฐุง ูุนูู ุฃู ูุญุณูุจุ

# ุตุญูุญ
line.debit_24k = 100
line.weight_type = 'PHYSICAL'  # ูุฒู ูุนูู (ูุฎุฒูู)
```

---

## ุฎูุงุตุฉ ุงูููุณูุฉ

### ๐ฏ ุงููุฏู ุงูููุงุฆู
> **ูุฑูุฏ ููุงุฆู ูุงููุฉ ุจูุบุชูู: ุฑูุงู **ู** ุฐูุจ**

### ๐๏ธ ุงูุฃุณุงุณ ุงููุญุงุณุจู
- ูู ููุฏ ููุฏู โ ููุฏ ูุฒูู ููุงุฒู (ุฅูุง ุงููุฎุฒูู)
- ุงููุฎุฒูู โ ูุฒู ูุนูู (ุงุณุชุซูุงุก)
- ุงูุฑุจุญ โ ููุญุณุจ ูู ุงูุชูุงุฑูุฑ (ููุณ ููุฏ)

### ๐๏ธ ุงูุชุทุจูู ุงูุชููู
- `WeightLedgerService` โ ูุญุฑู ุงูููุงุนุฏ ุงูููุญุฏ
- `weight_type` โ ุชูููุฒ ุงููุนูู ุนู ุงูุชุญูููู
- `verify_dual_balance` โ ุถูุงู ุงูุชูุงุฒู (Fail Fast)
- `gold_price_snapshot` โ ุฏูุฉ ุงูุชูุงุฑูุฑ ุงูุชุงุฑูุฎูุฉ

### ๐ ุงูููุงุฆุฏ
โ ููุงุณ ุงูุฃุฏุงุก ุงูุญูููู ุจุงูุฐูุจ  
โ ุญูุงูุฉ ูู ุชููุจุงุช ุงูุฃุณุนุงุฑ  
โ ููู ุชุขูู ุงูููุฉ ุงูุดุฑุงุฆูุฉ  
โ ูุฑุงุฑุงุช ูุงููุฉ ุฃูุซุฑ ุฏูุฉ  

---

## ๐ ูุฑุงุฌุน ุฅุถุงููุฉ

- `backend/services/weight_ledger_service.py` โ ูุญุฑู ุงูููุงุนุฏ
- `backend/dual_system_helpers.py` โ ุฏูุงู ุงููููุฏ ุงููุฒุฏูุฌุฉ
- `backend/models.py` โ JournalEntryLine.weight_type
- `DUAL_SYSTEM_QUICK_GUIDE.md` โ ุฏููู ุณุฑูุน

---

**ุขุฎุฑ ุชุญุฏูุซ**: 14 ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงููุทูุฑ**: Yasar Gold & Jewelry POS System
