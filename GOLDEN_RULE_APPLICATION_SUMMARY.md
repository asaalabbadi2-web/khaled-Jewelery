# โ ููุฎุต ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ูู ุงููุธุงู ุงููุญุงุณุจู ุงููุฒุฏูุฌ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุจูุฌุงุญ **ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ** ูู ูุธุงู ุงููุญุงุณุจุฉ ุงููุฒุฏูุฌ (ููุฏู + ูุฒูู) ูุน **ุฃุชูุชุฉ ูุงููุฉ** ูุฅูุดุงุก ุงูุญุณุงุจุงุช ุงููุฒููุฉ.

---

## ๐ฏ ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ุงููุทุจูุฉ

```
ุฃู ุฑูุงู ูุฏุฎู ุฃู ูุฎุฑุฌ ูู ุงูุฏูุชุฑ ุงูููุฏู
        โ
ููุญููู ุฅูู ุฌุฑุงู ูู ุฏูุชุฑ ุงููุฒู ุจุงุณุชุฎุฏุงู ุณุนุฑ ุงูุฐูุจ ุงููุจุงุดุฑ

ุงููุฒู ุจุงูุฌุฑุงู = ุงููุจูุบ ุงูููุฏู รท ุณุนุฑ ุงูุฌุฑุงู ุงููุจุงุดุฑ (24 ููุฑุงุท)
```

### ๐ด **ุงุณุชุซูุงุกุงุช ูููุฉ:**
- โ **ุญุณุงุจ ุงููุฎุฒูู**: ููุณุฌู ุจุงููุฒู ุงููุนูู (ูุง ููุญููู ูู ุงูููุฏู)
- โ **ุงูุฅูุฑุงุฏุงุช/ุงููุตุฑููุงุช**: ุชูุญููู ุจุงุณุชุฎุฏุงู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ

---

## ๐๏ธ ุงูุชุนุฏููุงุช ุงููููุฐุฉ

### 1๏ธโฃ **dual_system_helpers.py** - ุฅูุดุงุก ุฏูุงู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ

โ ุฅุถุงูุฉ ุฏุงูุฉ `create_golden_rule_entry()`:
```python
def create_golden_rule_entry(
    cash_account_id: int,
    amount_cash: float,
    direct_gold_price: float,
    description: str,
    date=None,
    is_debit_cash=True
) -> JournalEntry:
    """
    ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ: ุฃู ุฑูุงู โ ููุญููู ุฅูู ุฌุฑุงู
    """
```

โ ุฅุถุงูุฉ ุฏุงูุฉ `create_complete_golden_entry()`:
- ุชุฏูุฌ ุฅูุดุงุก ุงูููุฏ ุงููุงูู + ุงูููุฏ ุงููุฒูู
- ุชุทุจู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ุชููุงุฆูุงู
- ุชุชุนุงูู ูุน ุงุณุชุซูุงุก ุงููุฎุฒูู

---

### 2๏ธโฃ **routes.py** - ุชุนุฏูู ููุทู ุงูููุงุชูุฑ

#### โ ููุงุชูุฑ ุงูุจูุน (`POST /api/invoices` - type='sale`):
```python
# ุงุณุชุฎุฏุงู ุงูุณุนุฑ ุงููุจุงุดุฑ ููุฐูุจ ุจุฏูุงู ูู ุณุนุฑ ุงูุจูุน ุงููุญุณูุจ
gold_price_data = get_current_gold_price()
direct_gold_price_24k = gold_price_data['price_per_gram_24k']

# ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ููุฅูุฑุงุฏุงุช
revenue_weight = revenue_cash / direct_gold_price_24k
```

#### โ ููุงุชูุฑ ุงูุดุฑุงุก (`type='purchase'`):
```python
# ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ูุชูููุฉ ุงููุดุชุฑูุงุช
purchase_weight = total_cost_cash / direct_gold_price_24k
```

#### โ ุญุณุงุจ ุงููุฎุฒูู - ุงุณุชุซูุงุก ุงููุงุนุฏุฉ:
```python
# ุงููุฎุฒูู: ูุฒู ูุนูู ูู ุงูุตูู (ูุง ููุญููู)
actual_weight_in_main_karat = item.weight_in_main_karat()
```

---

### 3๏ธโฃ **renumber_accounts.py** - ุฃุชูุชุฉ ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงููุฒููุฉ

#### ๐ **ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ: ุงููุณุฎ ุงูุชููุงุฆู**

```python
def create_memo_copy_of_financial_accounts():
    """
    ๐ ููุณุฎ ุฌููุน ุงูุญุณุงุจุงุช ุงููุงููุฉ ุชููุงุฆูุงู ุฅูู ุญุณุงุจุงุช ูุฒููุฉ
    
    ุงูููุงุนุฏ:
    - ุฑูู ุงูุญุณุงุจ ุงููุฒูู = 7 + ุฑูู ุงูุญุณุงุจ ุงููุงูู
    - ุงุณู ุงูุญุณุงุจ ุงููุฒูู = ุงุณู ุงูุญุณุงุจ ุงููุงูู + " ูุฒูู"
    - transaction_type = 'gold'
    - tracks_weight = True
    - ูุญุงูุธ ุนูู ุงูุนูุงูุงุช ุงููุฑููุฉ (parent_id)
    """
```

#### ๐ **ุงููุชุงุฆุฌ:**
- โ ุชู ุฅูุดุงุก **74 ุญุณุงุจ** ุฅุฌูุงูุงู
  - ๐ต **37 ุญุณุงุจ ูุงูู** (ููุฏู - `transaction_type='cash'`)
  - โ๏ธ  **37 ุญุณุงุจ ูุฒูู** (ูุฐูุฑุฉ - `transaction_type='gold'`)
- โ **33 ุญุณุงุจ ูุฑุจูุท** ุชููุงุฆูุงู ุนุจุฑ `memo_account_id`
- โ **4 ุญุณุงุจุงุช ุฏุนู** ูุฏููุฉ (ูุตุงุฑูู ูุธุงูุฉุ ุตูุฑุ ุดุญูุ ูุฑููุงุช ุชูููู)

---

## ๐ ุงูุฑุจุท ุงูุชููุงุฆู

### ูุซุงู ุนูู ุงูุฑุจุท:

| ุงูุญุณุงุจ ุงููุงูู | ุงูุฑูู | ุงูุญุณุงุจ ุงููุฒูู | ุงูุฑูู |
|---------------|-------|---------------|-------|
| ุงูุฃุตูู | `1` | ุงูุฃุตูู ูุฒูู | `71` |
| ุงูุตูุฏูู | `1100` | ุงูุตูุฏูู ูุฒูู | `71100` |
| ุฅูุฑุงุฏุงุช ุจูุน ุฐูุจ | `40` | ุฅูุฑุงุฏุงุช ุจูุน ุฐูุจ ูุฒูู | `740` |
| ุชูููุฉ ุงููุจูุนุงุช | `50` | ุชูููุฉ ุงููุจูุนุงุช ูุฒูู | `750` |

---

## ๐งช ุงูุชุญูู ูู ุงูุตุญุฉ

### โ 1. ุงูุชุญูู ูู ุงูุญุณุงุจุงุช:
```bash
cd backend && source venv/bin/activate
python -c "from app import app, db; from models import Account;
with app.app_context():
    print('ุฅุฌูุงูู:', Account.query.count())
    print('ูุงูู:', Account.query.filter_by(transaction_type='cash').count())
    print('ูุฒูู:', Account.query.filter_by(transaction_type='gold').count())"
```

**ุงููุชูุฌุฉ:**
```
ุฅุฌูุงูู: 74
ูุงูู: 37
ูุฒูู: 37
```

### โ 2. ุงูุชุญูู ูู ุงูุฑุจุท:
```python
# ุงูุญุณุงุจ ุงููุงูู ูุฑุจูุท ุจุงูุญุณุงุจ ุงููุฒูู
account_1 = Account.query.filter_by(account_number='1').first()
print(account_1.memo_account_id)  # โ ูุดูุฑ ุฅูู id ุงูุญุณุงุจ 71
```

---

## ๐ ูุซุงู ุชุทุจููู: ูุงุชูุฑุฉ ุจูุน

### ุงูุณููุงุฑูู:
- ุจูุน ุฐูุจ ุนูุงุฑ 21 ุจูุฒู **10 ุฌุฑุงู**
- ุณุนุฑ ุงูุจูุน: **300 ุฑูุงู/ุฌุฑุงู** (ุดุงูู ุงููุตูุนูุฉ)
- ุณุนุฑ ุงูุฐูุจ ุงููุจุงุดุฑ (24 ููุฑุงุท): **250 ุฑูุงู/ุฌุฑุงู**

### ุงููููุฏ ุงููุญุงุณุจูุฉ:

#### 1๏ธโฃ **ุงูุฏูุชุฑ ุงูููุฏู** (Financial):
```
ูู ุญู/ ุงูุตูุฏูู (1100)              3,000 ุฑูุงู
    ุฅูู ุญู/ ุฅูุฑุงุฏุงุช ุจูุน ุฐูุจ (40)      3,000 ุฑูุงู
```

#### 2๏ธโฃ **ุฏูุชุฑ ุงููุฒู** (Memo) - ุชุทุจูู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:
```
ุงููุฒู = 3,000 ุฑูุงู รท 250 ุฑูุงู/ุฌุฑุงู = 12 ุฌุฑุงู

ูู ุญู/ ุงูุตูุฏูู ูุฒูู (71100)        12 ุฌุฑุงู
    ุฅูู ุญู/ ุฅูุฑุงุฏุงุช ุจูุน ุฐูุจ ูุฒูู (740)  12 ุฌุฑุงู
```

#### 3๏ธโฃ **ุงููุฎุฒูู** (ุงุณุชุซูุงุก - ุงููุฒู ุงููุนูู):
```
ุงูููุฏู:
ูู ุญู/ ุชูููุฉ ุงููุจูุนุงุช (50)          2,500 ุฑูุงู
    ุฅูู ุญู/ ูุฎุฒูู 21 (1310)            2,500 ุฑูุงู

ุงููุฒูู:
ูู ุญู/ ุชูููุฉ ุงููุจูุนุงุช ูุฒูู (750)    10 ุฌุฑุงู (ุงููุฒู ุงููุนูู)
    ุฅูู ุญู/ ูุฎุฒูู 21 ูุฒูู (71310)      10 ุฌุฑุงู
```

---

## โ๏ธ ุงููููุงุช ุงููุนุฏูุฉ

| ุงูููู | ุงูุชุนุฏูู | ุงูุญุงูุฉ |
|------|---------|--------|
| `dual_system_helpers.py` | ุฅุถุงูุฉ ุฏูุงู ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ | โ ููุชูู |
| `routes.py` | ุชุนุฏูู ููุทู ููุงุชูุฑ ุงูุจูุน/ุงูุดุฑุงุก | โ ููุชูู |
| `renumber_accounts.py` | ุฃุชูุชุฉ ูุณุฎ ุงูุญุณุงุจุงุช ุงููุฒููุฉ | โ ููุชูู |
| `config.py` | ุชุตุญูุญ `parent_number` ูุญุณุงุจ 7600 | โ ููุชูู |

---

## ๐ ุงูุชุดุบูู

### ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุญุณุงุจุงุช:
```bash
cd backend
source venv/bin/activate
python renumber_accounts.py --force
```

### ุงูุชุญูู:
```bash
# ุนุฑุถ ุงูุญุณุงุจุงุช
python -c "from app import app; from models import Account, db; ..."

# ุจุฏุก ุงูุฎุงุฏู
python app.py
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. โ **ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ุชุทุจู ุนูู:**
   - ุงูุฅูุฑุงุฏุงุช (ุจูุน ุฐูุจุ ูุตูุนูุฉ)
   - ุงููุตุฑููุงุช (ุชุดุบูููุฉุ ุชูููุฉ ูุจูุนุงุช)
   - ุงูุฐูู (ุนููุงุกุ ููุฑุฏูู)

2. ๐ด **ุงูุงุณุชุซูุงุก ุงููุญูุฏ:**
   - **ุงููุฎุฒูู**: ููุณุฌู ุจุงููุฒู ุงููุนูู ูู `item.weight_in_main_karat()`

3. โ **ุงูุณุนุฑ ุงููุณุชุฎุฏู:**
   - **ุณุนุฑ ุงูุฐูุจ ุงููุจุงุดุฑ** (24 ููุฑุงุท) ูู `get_current_gold_price()`
   - **ููุณ** ุณุนุฑ ุงูุจูุน ุงููุญุณูุจ

4. โ **ุงูุฑุจุท ุงูุชููุงุฆู:**
   - ูู ุญุณุงุจ ูุงูู ูู `memo_account_id` ูุดูุฑ ููุญุณุงุจ ุงููุฒูู ุงูููุงุจู
   - ููุณุชุฎุฏู ูู `create_dual_journal_entry()`

---

## โ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

- โ ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ ูุทุจูุฉ ุจุงููุงูู
- โ ุงูุญุณุงุจุงุช ุงููุฒููุฉ ููุดุฃุฉ ุชููุงุฆูุงู (74 ุญุณุงุจ: 37 ูุงูู + 37 ูุฒูู)
- โ ุงูุฑุจุท ุงูุชููุงุฆู ูุนูู (33 ุญุณุงุจ ูุฑุจูุท)
- โ ุงุณุชุซูุงุก ุงููุฎุฒูู ูุทุจู
- โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ุนูู ุงูููุงุชูุฑ

---

**ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ:** ููุงูุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ
